<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contador de Comidas</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #ffffff;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .charts-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
        }
        .chart-box {
            width: 250px;
            height: 250px;
            position: relative;
        }
        .chart-center-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            font-weight: bold;
        }
        .chart-center-text .main-value {
            font-size: 24px;
            color: #333;
        }
        .chart-center-text .sub-value {
            font-size: 16px;
            color: #666;
        }
        .section {
            margin-bottom: 30px;
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }
        .meal-type {
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .meal-header {
            background-color: #3498db;
            color: white;
            padding: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .meal-header:hover {
            background-color: #2980b9;
        }
        .meal-content {
            padding: 10px;
            display: none;
            background: white;
        }
        .search-box {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .food-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            border: 1px solid #eee;
            border-radius: 8px;
            background: #fafafa;
        }
        .food-quantity {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .quantity-input {
            width: 50px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.delete-btn {
            background-color: #e74c3c;
        }
        button.delete-btn:hover {
            background-color: #c0392b;
        }
        input {
            padding: 8px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .form-section {
            max-width: 500px;
            margin: 0 auto;
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .form-grid input {
            width: 100%;
        }
        .added-foods {
            margin-top: 20px;
        }
        .added-food-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background: #fff;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        @media (max-width: 768px) {
            .charts-container {
                flex-direction: column;
                align-items: center;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<h1>Contador Diario</h1>

<div class="charts-container">
    <div class="chart-box">
        <canvas id="caloriesChart"></canvas>
        <div class="chart-center-text">
            <div class="main-value" id="caloriesValue">0</div>
            <div class="sub-value">de 2600 kcal</div>
        </div>
    </div>
    <div class="chart-box">
        <canvas id="proteinChart"></canvas>
        <div class="chart-center-text">
            <div class="main-value" id="proteinValue">0</div>
            <div class="sub-value">de 140 g</div>
        </div>
    </div>
    <div class="chart-box">
        <canvas id="fatChart"></canvas>
        <div class="chart-center-text">
            <div class="main-value" id="fatValue">0</div>
            <div class="sub-value">de 55 g</div>
        </div>
    </div>
    <div class="chart-box">
        <canvas id="saturatedFatChart"></canvas>
        <div class="chart-center-text">
            <div class="main-value" id="saturatedFatValue">0</div>
            <div class="sub-value">de 20 g</div>
        </div>
    </div>
</div>

<div class="section">
    <h2>Alimentos Agregados Hoy</h2>
    <div id="added-foods" class="added-foods">
        <!-- Aquí aparecerán los alimentos que vayas agregando -->
    </div>
</div>

<div class="section">
    <h2>Mis Comidas</h2>
    
    <div class="meal-type">
        <div class="meal-header" onclick="toggleMeal('desayuno')">
            <span>Desayuno</span>
            <span>▼</span>
        </div>
        <div id="desayuno" class="meal-content">
            <input type="text" class="search-box" placeholder="Buscar alimento..." onkeyup="filterFoods('desayuno', this.value)">
            <div class="food-item" data-calories="68.8" data-protein="8" data-fat="0.8" data-saturatedFat="0.48">
                <span>cafe con leche</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
            <div class="food-item" data-calories="127.8" data-protein="19.5" data-fat="1.7" data-saturatedFat="1.03">
                <span>cafe con leche +proteina</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
            <div class="food-item" data-calories="27.03" data-protein="3.75" data-fat="0.89" data-saturatedFat="0.21">
                <span>1 panecillo</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
            </div>
        </div>
    </div>
    
    <div class="meal-type">
        <div class="meal-header" onclick="toggleMeal('almuerzo')">
            <span>Almuerzo</span>
            <span>▼</span>
        </div>
        <div id="almuerzo" class="meal-content">
            <input type="text" class="search-box" placeholder="Buscar alimento..." onkeyup="filterFoods('almuerzo', this.value)">
            <div class="food-item" data-calories="400" data-protein="25" data-fat="15" data-saturatedFat="5">
                <span>Bocadillo de jamón</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
            <div class="food-item" data-calories="200" data-protein="10" data-fat="8" data-saturatedFat="3">
                <span>Fruta</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="meal-type">
        <div class="meal-header" onclick="toggleMeal('comida')">
            <span>Comida</span>
            <span>▼</span>
        </div>
        <div id="comida" class="meal-content">
            <input type="text" class="search-box" placeholder="Buscar alimento..." onkeyup="filterFoods('comida', this.value)">
            <div class="food-item" data-calories="68.8" data-protein="8" data-fat="0.8" data-saturatedFat="0.48">
                <span>cafe con leche</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
            <div class="food-item" data-calories="127.8" data-protein="19.5" data-fat="1.7" data-saturatedFat="1.03">
                <span>cafe con leche +proteina</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="meal-type">
        <div class="meal-header" onclick="toggleMeal('merienda')">
            <span>Merienda</span>
            <span>▼</span>
        </div>
        <div id="merienda" class="meal-content">
            <input type="text" class="search-box" placeholder="Buscar alimento..." onkeyup="filterFoods('merienda', this.value)">
            <div class="food-item" data-calories="200" data-protein="10" data-fat="5" data-saturatedFat="2">
                <span>Frutos secos</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
            <div class="food-item" data-calories="150" data-protein="8" data-fat="3" data-saturatedFat="1">
                <span>Yogur natural</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="meal-type">
        <div class="meal-header" onclick="toggleMeal('cena')">
            <span>Cena</span>
            <span>▼</span>
        </div>
        <div id="cena" class="meal-content">
            <input type="text" class="search-box" placeholder="Buscar alimento..." onkeyup="filterFoods('cena', this.value)">
            <div class="food-item" data-calories="27.03" data-protein="3.75" data-fat="0.89" data-saturatedFat="0.21">
                <span>1 panecillo</span>
                <div class="food-quantity">
                    <input type="number" class="quantity-input" value="1" min="1">
                    <button onclick="addPredefinedFood(this)">+</button>
                </div>
            </div>
            </div>
        </div>
    </div>
</div>

<div class="section form-section">
    <h2>Añadir Alimento Nuevo</h2>
    <select id="mealType" style="width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 4px;">
        <option value="desayuno">Desayuno</option>
        <option value="almuerzo">Almuerzo</option>
        <option value="comida">Comida</option>
        <option value="merienda">Merienda</option>
        <option value="cena">Cena</option>
    </select>
    <input type="text" id="foodName" placeholder="Nombre del alimento">
    <div class="form-grid">
        <div>
            <input type="number" step="0.01" id="calories" placeholder="Calorías">
        </div>
        <div>
            <input type="number" step="0.01" id="protein" placeholder="Proteínas (g)">
        </div>
        <div>
            <input type="number" step="0.01" id="fat" placeholder="Grasas (g)">
        </div>
        <div>
            <input type="number" step="0.01" id="saturatedFat" placeholder="Grasas Saturadas (g)">
        </div>
    </div>
    <button onclick="addFood()" style="margin-top: 10px;">Añadir</button>
</div>

<div class="section">
    <button onclick="resetAll()" style="background-color: #e74c3c;">Borrar Todo</button>
</div>

<script>
    const maxCalories = 2600;
    const maxProtein = 140;
    const maxFat = 55;
    const maxSaturatedFat = 20;

    // Cargar datos del localStorage al iniciar
    let totalCalories = parseFloat(localStorage.getItem('totalCalories')) || 0;
    let totalProtein = parseFloat(localStorage.getItem('totalProtein')) || 0;
    let totalFat = parseFloat(localStorage.getItem('totalFat')) || 0;
    let totalSaturatedFat = parseFloat(localStorage.getItem('totalSaturatedFat')) || 0;
    let addedFoods = JSON.parse(localStorage.getItem('addedFoods')) || [];

    // Función para normalizar texto (eliminar acentos y convertir a minúsculas)
    function normalizeText(text) {
        return text.toLowerCase()
            .normalize("NFD")
            .replace(/[\u0300-\u036f]/g, "");
    }

    // Función para filtrar alimentos
    function filterFoods(mealId, searchText) {
        const mealContent = document.getElementById(mealId);
        const foodItems = mealContent.querySelectorAll('.food-item');
        const normalizedSearch = normalizeText(searchText);

        foodItems.forEach(item => {
            const foodName = normalizeText(item.querySelector('span').textContent);
            if (foodName.includes(normalizedSearch)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    // Función para parsear números con comas
    function parseNumber(value) {
        if (typeof value === 'string') {
            // Reemplazar comas por puntos para el parseo
            return parseFloat(value.replace(',', '.'));
        }
        return value;
    }

    // Guardar datos en el localStorage
    function saveData() {
        localStorage.setItem('totalCalories', totalCalories);
        localStorage.setItem('totalProtein', totalProtein);
        localStorage.setItem('totalFat', totalFat);
        localStorage.setItem('totalSaturatedFat', totalSaturatedFat);
        localStorage.setItem('addedFoods', JSON.stringify(addedFoods));
    }

    // Alternar visibilidad de las comidas
    function toggleMeal(mealId) {
        const mealContent = document.getElementById(mealId);
        const mealHeader = mealContent.previousElementSibling;
        
        if (mealContent.style.display === 'block') {
            mealContent.style.display = 'none';
            mealHeader.querySelector('span:last-child').textContent = '▼';
        } else {
            mealContent.style.display = 'block';
            mealHeader.querySelector('span:last-child').textContent = '▲';
            // Limpiar el buscador al abrir
            mealContent.querySelector('.search-box').value = '';
            // Mostrar todos los items
            const foodItems = mealContent.querySelectorAll('.food-item');
            foodItems.forEach(item => item.style.display = 'flex');
        }
    }

    // Actualizar los valores numéricos en el centro de las gráficas
    function updateCenterValues() {
        document.getElementById('caloriesValue').textContent = `${totalCalories.toFixed(2)} / ${(maxCalories - totalCalories).toFixed(2)}`;
        document.getElementById('proteinValue').textContent = `${totalProtein.toFixed(2)} / ${(maxProtein - totalProtein).toFixed(2)}`;
        document.getElementById('fatValue').textContent = `${totalFat.toFixed(2)} / ${(maxFat - totalFat).toFixed(2)}`;
        document.getElementById('saturatedFatValue').textContent = `${totalSaturatedFat.toFixed(2)} / ${(maxSaturatedFat - totalSaturatedFat).toFixed(2)}`;
    }

    const caloriesChart = new Chart(document.getElementById('caloriesChart'), {
        type: 'doughnut',
        data: {
            labels: ['Consumidas', 'Restantes'],
            datasets: [{
                data: [0, maxCalories],
                backgroundColor: ['#f39c12', '#ecf0f1']
            }]
        },
        options: { 
            responsive: true, 
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.raw.toFixed(2)} kcal`;
                        }
                    }
                }
            }
        }
    });

    const proteinChart = new Chart(document.getElementById('proteinChart'), {
        type: 'doughnut',
        data: {
            labels: ['Consumidas', 'Restantes'],
            datasets: [{
                data: [0, maxProtein],
                backgroundColor: ['#27ae60', '#ecf0f1']
            }]
        },
        options: { 
            responsive: true, 
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.raw.toFixed(2)} g`;
                        }
                    }
                }
            }
        }
    });

    const fatChart = new Chart(document.getElementById('fatChart'), {
        type: 'doughnut',
        data: {
            labels: ['Consumidas', 'Restantes'],
            datasets: [{
                data: [0, maxFat],
                backgroundColor: ['#e67e22', '#ecf0f1']
            }]
        },
        options: { 
            responsive: true, 
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.raw.toFixed(2)} g`;
                        }
                    }
                }
            }
        }
    });

    const saturatedFatChart = new Chart(document.getElementById('saturatedFatChart'), {
        type: 'doughnut',
        data: {
            labels: ['Consumidas', 'Restantes'],
            datasets: [{
                data: [0, maxSaturatedFat],
                backgroundColor: ['#c0392b', '#ecf0f1']
            }]
        },
        options: { 
            responsive: true, 
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${context.raw.toFixed(2)} g`;
                        }
                    }
                }
            }
        }
    });

    function updateCharts() {
        caloriesChart.data.datasets[0].data = [totalCalories, Math.max(maxCalories - totalCalories, 0)];
        proteinChart.data.datasets[0].data = [totalProtein, Math.max(maxProtein - totalProtein, 0)];
        fatChart.data.datasets[0].data = [totalFat, Math.max(maxFat - totalFat, 0)];
        saturatedFatChart.data.datasets[0].data = [totalSaturatedFat, Math.max(maxSaturatedFat - totalSaturatedFat, 0)];
        
        caloriesChart.update();
        proteinChart.update();
        fatChart.update();
        saturatedFatChart.update();
        
        updateCenterValues();
        saveData();
    }

    function addFood() {
        const mealType = document.getElementById('mealType').value;
        const name = document.getElementById('foodName').value.trim();
        const calories = parseNumber(document.getElementById('calories').value);
        const protein = parseNumber(document.getElementById('protein').value);
        const fat = parseNumber(document.getElementById('fat').value);
        const saturatedFat = parseNumber(document.getElementById('saturatedFat').value);

        if (!name || isNaN(calories) || isNaN(protein) || isNaN(fat) || isNaN(saturatedFat)) {
            alert("Por favor completa todos los campos.");
            return;
        }

        // Añadir a la lista de alimentos correspondiente
        const mealContent = document.getElementById(mealType);
        const newItem = document.createElement('div');
        newItem.className = 'food-item';
        newItem.setAttribute('data-calories', calories);
        newItem.setAttribute('data-protein', protein);
        newItem.setAttribute('data-fat', fat);
        newItem.setAttribute('data-saturatedFat', saturatedFat);
        newItem.innerHTML = `
            <span>${name}</span>
            <div class="food-quantity">
                <input type="number" class="quantity-input" value="1" min="1">
                <button onclick="addPredefinedFood(this)">+</button>
            </div>
        `;
        mealContent.appendChild(newItem);

        // Limpiar inputs
        document.getElementById('foodName').value = "";
        document.getElementById('calories').value = "";
        document.getElementById('protein').value = "";
        document.getElementById('fat').value = "";
        document.getElementById('saturatedFat').value = "";
    }

    function addPredefinedFood(button) {
        const parent = button.closest('.food-item');
        const quantityInput = parent.querySelector('.quantity-input');
        const quantity = parseInt(quantityInput.value) || 1;
        
        const calories = parseNumber(parent.getAttribute('data-calories')) * quantity;
        const protein = parseNumber(parent.getAttribute('data-protein')) * quantity;
        const fat = parseNumber(parent.getAttribute('data-fat')) * quantity;
        const saturatedFat = parseNumber(parent.getAttribute('data-saturatedFat')) * quantity;
        const name = parent.querySelector('span').textContent + (quantity > 1 ? ` (x${quantity})` : '');

        totalCalories += calories;
        totalProtein += protein;
        totalFat += fat;
        totalSaturatedFat += saturatedFat;

        // Añadir a la lista de alimentos agregados
        const foodId = Date.now();
        addedFoods.push({
            id: foodId,
            name: name,
            calories: calories,
            protein: protein,
            fat: fat,
            saturatedFat: saturatedFat,
            quantity: quantity
        });

        updateAddedFoodsList();
        updateCharts();
        
        // Resetear el contador a 1 después de agregar
        quantityInput.value = 1;
    }

    function updateAddedFoodsList() {
        const addedFoodsList = document.getElementById('added-foods');
        addedFoodsList.innerHTML = '';

        if (addedFoods.length === 0) {
            addedFoodsList.innerHTML = '<p>No has agregado alimentos aún.</p>';
            return;
        }

        addedFoods.forEach(food => {
            const foodItem = document.createElement('div');
            foodItem.className = 'added-food-item';
            foodItem.innerHTML = `
                <span>${food.name} (${food.calories.toFixed(2)} kcal, ${food.protein.toFixed(2)}g prot.)</span>
                <button class="delete-btn" onclick="removeFood(${food.id})">×</button>
            `;
            addedFoodsList.appendChild(foodItem);
        });
    }

    function removeFood(foodId) {
        const foodIndex = addedFoods.findIndex(food => food.id === foodId);
        if (foodIndex !== -1) {
            const food = addedFoods[foodIndex];
            totalCalories -= food.calories;
            totalProtein -= food.protein;
            totalFat -= food.fat;
            totalSaturatedFat -= food.saturatedFat;
            
            addedFoods.splice(foodIndex, 1);
            updateAddedFoodsList();
            updateCharts();
        }
    }

    function resetAll() {
        if (confirm("¿Estás seguro de que quieres borrar todos los datos?")) {
            totalCalories = 0;
            totalProtein = 0;
            totalFat = 0;
            totalSaturatedFat = 0;
            addedFoods = [];
            updateAddedFoodsList();
            updateCharts();
            localStorage.clear();
        }
    }

    // Inicializar la aplicación al cargar
    window.onload = function() {
        updateCharts();
        updateAddedFoodsList();
        
        // Mostrar todos los menús desplegables al inicio
        document.querySelectorAll('.meal-content').forEach(meal => {
            meal.style.display = 'none';
        });
    };
</script>

</body>
</html>
